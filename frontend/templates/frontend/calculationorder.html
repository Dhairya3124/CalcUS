{% extends 'frontend/base.html' %}

{% load static %}

{% block extrahead %}
	<link rel="stylesheet" href="{% static 'frontend/uis/jquery-ui-1.11.4.css' %}" type="text/css">
	<script src="https://code.jquery.com/jquery-3.1.0.min.js"></script>

	<script>
		function load_logs(id) {
			$("#log_div").load("/log/" + id);
		}
		function cancel(id) {
			$.ajax({
				method: "POST",	 	 
				url: "/cancel_calc/",
				headers: {
					"X-CSRFToken": '{{ csrf_token }}',
				},
				data: {'id': id},
				success: function() {
					$("#cancel_button_" + id).addClass("has-background-success");
				}
			});

		}
		function restart(id) {
			$.ajax({
				method: "POST",	 	 
				url: "/restart_calc/",
				headers: {
					"X-CSRFToken": '{{ csrf_token }}',
				},
				data: {'id': id},
				success: function() {
					$("#restart_button_" + id).addClass("has-background-success");
				}
			});

		}
		function cont(id) {
			$.ajax({
				method: "POST",	 	 
				url: "/continue_calc/",
				headers: {
					"X-CSRFToken": '{{ csrf_token }}',
				},
				data: {'id': id},
				success: function() {
					$("#continue_button_" + id).addClass("has-background-success");
				}
			});

		}

		function refetch(id) {
			$.ajax({
				method: "POST",	 	 
				url: "/refetch_calc/",
				headers: {
					"X-CSRFToken": '{{ csrf_token }}',
				},
				data: {'id': id},
				success: function() {
					$("#refetch_button_" + id).addClass("has-background-success");
				}
			});

		}

	</script>
	{% endblock %}

{% block content %}
<div class="container">
	<div class="box">
		<center>
					{% if order.ensemble %}
						<h3 class="title is-h3">Calculation Order {{ order.id }} - {{ order.ensemble.name }}</h3>
					{% else %}
					<h3 class="title is-h3">Calculation Order {{ order.id }} - {{ order.structure.parent_ensemble.name }}</h3>
					{% endif %}

			<table class="table">
				<thead>
					<tr>
						<th>Calculation id</th>
						<th>Status</th>
						<th>CPU time (s)</th>
						<th>Actions</th>
					</tr>
				</thead>
				<tbody>
					{% for calc in order.calculation_set.all %}
					<tr>
						<th>{{ calc.id }}</th>
						<th>{{ calc.text_status }}</th>
						<th>{{ calc.execution_time }}</th>
						<th><a class="button" onclick="load_logs({{ calc.id }});">View Logs</a> <a class="button" href="/download_log/{{ calc.id }}">Download Logs</a>{% if request.user.profile == order.author %}<a class="button" id="cancel_button_{{ calc.id }}" onclick="cancel({{ calc.id }});">Kill</a> {% if not calc.local %} <a class="button" id="restart_button_{{ calc.id }}" onclick="restart({{ calc.id }});">Restart</a><a class="button" id="refetch_button_{{ calc.id }}" onclick="refetch({{ calc.id }});">Refetch</a> {% endif %}<a class="button" id="continue_button_{{ calc.id }}" onclick="cont({{ calc.id }});">Continue</a> {% endif %}</th>
					</tr>
					{% endfor %}
				</tbody>
			</table>
		</center>
		<div id="log_div">
		</div>
	</div>
</div>
<br />
{% endblock %}


